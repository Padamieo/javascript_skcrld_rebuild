
var general = {

  setup: function(game){

		// Create a white rectangle that we'll use to represent the flash
		game.flash = game.add.graphics(0, 0);
		game.flash.beginFill(0xffffff, 1);
		game.flash.drawRect(0, 0, game.width, game.height);
		game.flash.endFill();
		game.flash.alpha = 0;

    game.world.setBounds(-10, -10, game.width + 20, game.height + 20);
    //this may be the key to sorting screen size with clickable areas

    //setup emitter for burst
    game.emitter = game.add.emitter(0, 0, 100);
    game.emitter.makeParticles('test');
    // game.emitter.setAll('scale.x', scaleRatio); // does not work
    // game.emitter.setAll('scale.y', scaleRatio);
    game.emitter.gravity = 200;

    game.score = 0;
    game.kills = 0;
    game.misses = 0;


    //create explotion animations as group to be called, need to add scale
    game.explosion = game.add.group();
    game.explosion.createMultiple(100, 'explosion');
    game.explosion.setAll('anchor.x', 0.5);
    game.explosion.setAll('anchor.y', 0.5);
    game.explosion.setAll('killOnComplete',true);
    game.explosion.callAll('animations.add', 'animations', 'boom', [0, 1, 3], 30, false);
    //http://www.html5gamedevs.com/topic/4384-callback-when-animation-complete/

  },

  explosion: function(game, loc){
		if (game.explosion.countDead() === 0) {
			return;
		}
		general.burst(game, loc.x, loc.y);
		bang = game.explosion.getFirstExists(false);
		//bang.rotation = 180;
		bang.reset(loc.x, loc.y);
		bang.play('boom', 30, 1, true);
	},

  burst: function(game, x, y){
		game.emitter.x = x;
		game.emitter.y = y;
		game.emitter.start(true, 2000, null, 10);
	},

  flash: function (game){
    game.flash.alpha = 1;
    game.add.tween(game.flash)
    .to({ alpha: 0 }, 100, Phaser.Easing.Cubic.In)
    .start();
  },

  shake: function(game){
		game.camera.y = 0;
		game.add.tween(game.camera)
		.to({ y: -10 }, 40, Phaser.Easing.Sinusoidal.InOut, false, 0, 5, true)
		.start();
		/*
  		//think this is a lighter shake
  		.to({ y: -10 }, 40, Phaser.Easing.Elastic.InOut, false, 0, 5, true)
  		.start();
		*/
	},

  click_exit: function() {
    if(navigator.app){
      navigator.app.exitApp();
    }else if(navigator.device){
      navigator.device.exitApp();
    }
  },

  update_lives: function(game){
    console.log(game.lives);
    if( game.lives <= 8 ){
      // ts = (game.timestamp + 1);
      console.log(game.timestamp + 0.5);
      if((+new Date() / 60000) >= (game.timestamp + 0.5) ){
        game.timestamp = game.timestamp + 0.5;
        game.lives = game.lives + 1;
        localStorage.setItem("lives", game.lives );
        general.updateText(game);
      }
    }
  },

  check_store: function(game){
    if(localStorage != undefined){
      console.log("Local Storage is supported");

      if(localStorage.getItem('lives') === null){
        localStorage.setItem('lives', 9 );
        game.lives = 9;
      }else{
        game.lives = parseInt(localStorage.getItem("lives"));
      }

      if(localStorage.getItem('timestamp') === null){
        localStorage.setItem("timestamp", 0 );
        game.timestamp = 0;
      }else{
        game.timestamp = parseInt(localStorage.getItem('timestamp'));
      }

      if(localStorage.getItem('highscore') === null){
        localStorage.setItem("highscore",  0 );
        game.highscore = 0;
      }else{
        game.highscore = parseInt(localStorage.getItem('highscore'));
      }

      //localStorage.removeItem("Website");
    }else{
      //window.analytics.enableUncaughtExceptionReporting(Enable, success, error);
      console.log("No support");
    }
  },

  updateText: function(game){
    var phaserJSON = game.cache.getJSON('language');
    text_lives.setText(phaserJSON.lives+' '+game.lives);
  },

  delete_store: function(){
    if(localStorage != undefined){
      localStorage.clear();
    }
  },

  enemy_colour: function(enemy_type){
    if(enemy_type === 0){
      return 0xf24e4e;
    }
    if(enemy_type === 1){
      return 0x4ef24e;
    }
  },

  missed_shot: function(){
    this.game.misses++;
  },

  go_to: function(state){
    //game = this.game;
    //console.log(game);

    if(state === 'opti'){
      game.state.start('opti');
      //window.analytics.trackEvent('menu', 'options', 'Hits', 1);
    }

    if(state === 'menu'){
      game.state.start('menu');
      //window.analytics.trackEvent('opti', 'opti', 'Hits', 1);
    }

    if(state === 'main'){
      game.state.start('main');
      //this.game.state.start('main');
      //window.analytics.trackEvent('opti', 'opti', 'Hits', 1);
    }

  }

};

module.exports = general;
